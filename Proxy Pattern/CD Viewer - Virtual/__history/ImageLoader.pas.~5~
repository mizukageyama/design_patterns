unit ImageLoader;

interface

uses
  ImageLoaderIntf, REST.Client, System.SysUtils, System.Classes;

type
  TImageLoader = class(TInterfacedObject, IImageLoader)
  private
    FRESTClient: TRESTClient;
  public
    constructor Create;
    destructor Destroy; override;
    function LoadImageFromURL(url: string): string;
  end;

implementation

{ TImageLoader }

constructor TImageLoader.Create;
begin
  FRESTClient := FRESTClient.Create(nil);

end;

destructor TImageLoader.Destroy;
begin
  FRESTClient.Free;
  inherited;
end;

function TImageLoader.LoadImageFromURL(url: string): string;
var
  ImageStream: TMemoryStream;
begin
  ImageStream := TMemoryStream.Create;
  try
    try
      FRESTClient.BaseURL := url;
      FRESTClient.ResetToDefaults;
      FRESTClient.Accept := 'image/jpeg'; // Specify the expected content type (optional)
      FRESTClient.Get(ImageStream);
      // Here, you can save the image to a file, display it, or process it as needed.
      // For this example, we'll just return a message.
      Result := 'Loaded image from URL: ' + url;
    except
      on E: Exception do
      begin
        Result := 'Error loading image from URL: ' + E.Message;
      end;
    end;
  finally
    ImageStream.Free;
  end;
end;

end.
